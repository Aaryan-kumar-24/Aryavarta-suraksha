{% include "header.html" %}

<style>

/* ===== PAGE TITLE ===== */
.home-title{
  text-align:center;
  font-size:2.3rem;
  font-weight:700;
  margin:30px 0 40px 0;
  color:#efff9f;
  letter-spacing:1px;
  animation:homePulse 3s ease-in-out infinite;
}

@keyframes homePulse{
  0%,100%{
    text-shadow:0 0 10px rgba(0,255,170,0.35);
    transform:scale(1);
  }
  50%{
    text-shadow:0 0 24px rgba(0,255,170,0.75);
    transform:scale(1.03);
  }
}


/* ===== GRID ===== */
.monitor-grid{
  display:grid;
  grid-template-columns:repeat(2, minmax(320px, 810px));
  justify-content:center;
  align-items:start;
  column-gap:60px;
  row-gap:50px;
  padding:10px 20px;
}

/* ===== BLOCK ===== */
.monitor-block{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:14px;
  transition:transform 0.35s ease;
  text-decoration:none;
}

/* ===== TITLE ===== */
.monitor-title{
  font-weight:600;
  color:#9fffd2;
  text-align:center;
}

/* ===== GLASS VIDEO CARD ===== */
.monitor-box{
  height:360px;
  width:100%;
  max-width:900px;

  border-radius:18px;
  overflow:hidden;

  background:rgba(0,0,0,0.35);
  backdrop-filter:blur(12px);
  border:1px solid rgba(120,255,180,0.25);

  animation:breatheFloatGreen 5s ease-in-out infinite;
  transition:box-shadow 0.35s ease;
}

/* ===== ALTERNATING BREATH DELAYS ===== */
.monitor-block:nth-child(2) .monitor-box{ animation-delay:1s; }
.monitor-block:nth-child(3) .monitor-box{ animation-delay:2s; }
.monitor-block:nth-child(4) .monitor-box{ animation-delay:3s; }

/* ===== HOVER ===== */
.monitor-block:hover{ transform:scale(1.05); }
.monitor-block:hover .monitor-box{
  animation:pulseSoftRed 1.2s ease-in-out infinite;
}

/* ===== VIDEO ===== */
.monitor-box img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ===== ANIMATIONS ===== */
@keyframes breatheFloatGreen{
  0%{
    transform:translateY(0px) scale(1);
    box-shadow:0 0 14px rgba(0,255,140,0.35);
  }
  50%{
    transform:translateY(-6px) scale(1.03);
    box-shadow:0 0 32px rgba(0,255,140,0.7);
  }
  100%{
    transform:translateY(0px) scale(1);
    box-shadow:0 0 14px rgba(0,255,140,0.35);
  }
}

@keyframes pulseSoftRed{
  0%{ box-shadow:0 0 18px rgba(255,70,70,0.55); }
  50%{ box-shadow:0 0 40px rgba(255,40,40,0.95); }
  100%{ box-shadow:0 0 18px rgba(255,70,70,0.55); }
}

/* ===== RESPONSIVE ===== */
@media (max-width:1100px){
  .monitor-grid{
    grid-template-columns:1fr;
    row-gap:40px;
  }
}

@media (max-width:600px){
  .monitor-box{ height:280px; }
}
/* ===== TITLE WITH LOGO ===== */
.home-title-wrap{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  margin:30px 0 40px 0;
  animation:homePulse 3s ease-in-out infinite;
}

/* Logo beside title */
.home-logo{
  height:42px;
  width:42px;
  border-radius:50%;
  object-fit:cover;
}

/* Text style */
.home-title-text{
  font-size:2.3rem;
  font-weight:700;
  color:#efff9f;
  letter-spacing:1px;
}


</style>


<!-- ===== TITLE OUTSIDE GRID ===== -->
{% load static %}

<div class="home-title-wrap">
  <img src="{% static 'logo.jpg' %}" class="home-logo" alt="logo">
  <div class="home-title-text">
    Aryavarta Suraksha ‚Ä¢ Intelligent Smart Surveillance Hub
  </div>
</div>


<!-- ===== GRID START ===== -->
<div class="monitor-grid">

  <!-- FACE ATTENDANCE -->
  <a href="/attendance/" class="monitor-block">
    <div class="monitor-title">üë§ Face Attendance Monitoring</div>
    <div class="monitor-box">
      <img src="/attendance/stream/" alt="Face Attendance">
    </div>
  </a>

  <!-- HEATMAP -->
  <a href="/heatmap/" class="monitor-block">
    <div class="monitor-title">üî• Motion Heatmap Detection</div>
    <div class="monitor-box">
      <img src="/heatmap/stream/" alt="Heatmap">
    </div>
  </a>

  <!-- NO ENTRY -->
  <a href="/alert/" class="monitor-block">
    <div class="monitor-title">üö´ Restricted Area Alert</div>
    <div class="monitor-box">
      <img src="/alert/stream/" alt="No Entry">
    </div>
  </a>

  <!-- WAITING -->
  <a href="/wait/" class="monitor-block">
    <div class="monitor-title">‚è≥ Suspicious Waiting Detection</div>
    <div class="monitor-box">
      <img src="/wait/stream/" alt="Waiting Zone">
    </div>
  </a>

</div>
<!-- ================= REPORT DASHBOARD ================= -->

<style>
.report-card{
  max-width:1200px;
  margin:70px auto;
  padding:35px;
  border-radius:18px;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(120,255,180,0.25);
  backdrop-filter:blur(12px);
}

.report-title{
  text-align:center;
  font-size:2rem;
  color:#9fffd2;
  margin-bottom:10px;
}

.report-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:25px;
}

.report-box{
  background:rgba(0,0,0,0.35);
  border-radius:14px;
  padding:18px;
  border:1px solid rgba(255,255,255,0.15);
}

.report-box h3{
  text-align:center;
  margin-bottom:10px;
  color:#efff9f;
}

.report-box table{
  width:100%;
  border-collapse:collapse;
}

.report-box th,
.report-box td{
  border:1px solid rgba(255,255,255,0.2);
  padding:8px;
  text-align:center;
}

/* PRINT BUTTON */
.print-wrap{ text-align:center; margin-top:40px; }

.print-btn{
  padding:16px 40px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.35);
  background:rgba(0,0,0,0.35);
  color:#9fffd2;
  font-size:1.1rem;
  font-weight:600;
  cursor:pointer;
  transition:.3s;
  animation:breatheGreen 3s ease-in-out infinite;
}

@keyframes breatheGreen{
  0%{ box-shadow:0 0 12px rgba(0,255,140,.35); }
  50%{ box-shadow:0 0 28px rgba(0,255,140,.9); }
  100%{ box-shadow:0 0 12px rgba(0,255,140,.35); }
}

.print-btn:hover{
  transform:scale(1.08);
}

/* ===== CLEAN PRINT VIEW ===== */
@media print{
  body *{ visibility:hidden; }

  #reportCard, #reportCard *{
    visibility:visible;
  }

  #reportCard{
    position:absolute;
    left:0;
    top:0;
    width:100%;
    background:white;
    color:black;
    padding:40px;
    font-family:Arial;
  }

  .report-grid{ display:block; }

  .report-box{
    background:white !important;
    border:1px solid #ccc !important;
    margin-bottom:20px;
  }

  table{ width:100%; border-collapse:collapse; }
  th, td{ border:1px solid #999 !important; color:black; }

  .print-wrap{ display:none; }
}
</style>


<div class="report-card" id="reportCard">

  <div class="report-title">üìä Suraksha Surveillance Report</div>

  <div class="report-grid">

    <div class="report-box">
      <h3>üî• Heatmap Alerts</h3>
      <table id="heatTable"></table>
    </div>

    <div class="report-box">
      <h3>üö´ Restricted Entry</h3>
      <table id="noentryTable"></table>
    </div>

    <div class="report-box">
      <h3>‚è≥ Waiting Alerts</h3>
      <table id="waitTable"></table>
    </div>

    <div class="report-box">
      <h3>üë§ Attendance</h3>
      <table id="attTable"></table>
    </div>

  </div>

  <div class="print-wrap">
    <button id="printBtn" class="print-btn">üñ® Print Report</button>
  </div>

</div>


<script>
function to12Hour(t){
  let d = new Date("1970-01-01T"+t);
  return isNaN(d) ? t : d.toLocaleTimeString([], {
    hour:"numeric", minute:"2-digit", second:"2-digit", hour12:true
  });
}

function fillTable(id,data,type){
  let html = `<tr>${type==="att"
      ? "<th>#</th><th>Name</th><th>Time</th>"
      : "<th>#</th><th>Time</th>"}</tr>`;

  if(!data || data.length===0){
    html += `<tr><td colspan="${type==="att"?3:2}">No data</td></tr>`;
  }else{
    data.forEach((item,i)=>{
      if(type==="att"){
        html += `<tr><td>${i+1}</td><td>${item.name}</td><td>${to12Hour(item.time)}</td></tr>`;
      }else{
        html += `<tr><td>${i+1}</td><td>${to12Hour(item)}</td></tr>`;
      }
    });
  }

  document.getElementById(id).innerHTML = html;
}

async function loadReport(){
  const r = await fetch("/report/data/");
  const data = await r.json();

  fillTable("heatTable", data.heat);
  fillTable("noentryTable", data.noentry);
  fillTable("waitTable", data.wait);
  fillTable("attTable", data.attendance, "att");
}

/* ===== DIRECT PRINT PREVIEW (NO NEW TAB) ===== */
document.getElementById("printBtn").onclick = async () => {
  await loadReport();   // ensure data present
  setTimeout(() => window.print(), 200);  // allow DOM render
};

/* initial load */
loadReport();
</script>

{% include "footer.html" %}
